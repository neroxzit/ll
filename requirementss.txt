pymongo==4.6.2
Pyrogram==2.0.106
Requests==2.31.0
Telethon==1.34.0
TgCrypto
requests


API_ID = "14837825"
API_HASH = "0ed849f5e7ab2df61d969317de2ca64c"
admin = -1404114574

# Replace with your bot token
token = "7063341831:AAFX80TtAyeQyW4rqZpx9mwBWco1xzrAnzA"



    async with bot.conversation(event.chat_id) as x:
        await event.answer(f"- ØªÙ… Ø¨Ø¯Ø§ Ø¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù…ÙŠØ² Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø´Ø¹Ø§Ø±", alert=True)
        acc = db.get("accounts")
        count = 0
        for i in acc:
            async with TelegramClient(StringSession(i["session"]), API_ID, API_HASH) as X:
                async for message in X.iter_messages(777000, limit=None):
                    try:
                        if message.action and hasattr(message.action, 'slug'):
                            gift_code = message.action.slug
                            subscription_duration = message.action.months
                            await bot.send_message(admin, f"**â€¢ Ø±Ø§Ø¨Ø· ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ù…ÙŠØ² Ø¬Ø¯ÙŠØ¯ ğŸ¥³**\n\n- Ø§Ù„Ø±Ø§Ø¨Ø· : https://t.me/giftcode/{gift_code}\n- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ : `{i['phone_number']}`")
                            count += 1
                    except Exception as e:
                        print(f"Error while fetching gift code: {e}")
        await bot.send_message(admin, f"- ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØªÙ… Ø§ÙŠØ¬Ø§Ø¯ {count} Ø±ÙˆØ§Ø¨Ø·")






async def  get_gift(event):
    async with bot.conversation(event.chat_id) as x:
        await event.answer(f"- ØªÙ… Ø¨Ø¯Ø§ Ø¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù…ÙŠØ² Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø´Ø¹Ø§Ø±", alert=True)
        acc = db.get("accounts")
        used_gift_links = set()  # ØªØ¹Ø±ÙŠÙ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        count = 0
        for i in acc:
            async with TelegramClient(StringSession(i["session"]), API_ID, API_HASH) as X:
                async for message in X.iter_messages(777000, limit=None):
                    try:
                        if isinstance(message.action, types.MessageActionGiftCode):
                            gift_code = message.action.slug
                            subscription_duration = message.action.months
                            gift_link = f"https://t.me/giftcode/{gift_code}"
                            phone_number = i['phone_number']
                            if gift_link in used_gift_links:
                                # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³Ø¨Ù‚Ù‹Ø§ØŒ Ù‚Ù… Ø¨Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                                await bot.send_message(admin, f"**â€¢ Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³Ø¨Ù‚Ù‹Ø§ ğŸš«**\n\n- Ø§Ù„Ø±Ø§Ø¨Ø· : {gift_link}\n- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ : `{phone_number}`\n- Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ : {subscription_duration} Ø´Ù‡ÙˆØ±")
                                continue
                            
                            # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ±Ø§Ø¨Ø· Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ù‹Ø§
                            used_gift_links.add(gift_link)
                            await bot.send_message(admin, f"**â€¢ Ø±Ø§Ø¨Ø· ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ù…ÙŠØ² Ø¬Ø¯ÙŠØ¯ ğŸ¥³**\n\n- Ø§Ù„Ø±Ø§Ø¨Ø· : {gift_link}\n- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ : `{phone_number}`\n- Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ : {subscription_duration} Ø´Ù‡ÙˆØ±")
                            #await bot.send_message(admin, f"**â€¢ Ø±Ø§Ø¨Ø· ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ù…ÙŠØ² Ø¬Ø¯ÙŠØ¯ ğŸ¥³**\n\n- Ø§Ù„Ø±Ø§Ø¨Ø· : https://t.me/giftcode/{gift_code}\n- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ : `{i['phone_number']}`\n- Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ : {subscription_duration} Ø´Ù‡ÙˆØ±")
                            count += 1
                    except Exception as e:
                        print(f"Error while fetching gift code: {e}")
        await bot.send_message(admin, f"- ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØªÙ… Ø§ÙŠØ¬Ø§Ø¯ {count} Ø±ÙˆØ§Ø¨Ø·")